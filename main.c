
// github.com/jcwml
// gcc main.c -lm -Ofast -mavx -mfma4 -o main
#include <stdio.h>
#include <string.h>
#include <math.h>
#include <stdint.h>
#include <sys/time.h>

#include <x86intrin.h>

#define NUM_ITERATIONS 1000000000
//#define NUM_ITERATIONS 100000

uint64_t microtime()
{
    struct timeval tv;
    struct timezone tz;
    memset(&tz, 0, sizeof(struct timezone));
    gettimeofday(&tv, &tz);
    return 1000000 * tv.tv_sec + tv.tv_usec;
}

// https://en.wikipedia.org/wiki/Fast_inverse_square_root
float InvSqrt(float x)
{
    float xhalf = 0.5f * x;
    int i = *(int*)&x;            // store floating-point bits in integer
    i = 0x5f3759df - (i >> 1);    // initial guess for Newton's method
    x = *(float*)&i;              // convert new bits into float
    x = x*(1.5f - xhalf*x*x);     // One round of Newton's method
    return x;
}

float nx, ny, nz;
void norm(float x, float y, float z)
{
    const float len = 1.f/sqrtf(x*x + y*y + z*z);
    nx = x * len;
    ny = y * len;
    nz = z * len;
}
float nx1, ny1, nz1;
void norm_inv(float x, float y, float z)
{
    const float len = InvSqrt(x*x + y*y + z*z);
    nx1 = x * len;
    ny1 = y * len;
    nz1 = z * len;
}
float nx2, ny2, nz2;
void norm_intrin(float x, float y, float z)
{
    const float len = _mm_cvtss_f32(_mm_rsqrt_ss(_mm_set_ss(x*x + y*y + z*z)));
    nx2 = x * len;
    ny2 = y * len;
    nz2 = z * len;
}

// tanh_adam_0_16_128_3333333_6_[0.90]
const float nv0[] = {-0.39879575,-0.48412916,0.450909, /* bias */ 0.25869402,0.27027094,-0.06547201,0.4244762, /* bias */ -0.3684898,0.64823955,-0.45263678,-0.29404083, /* bias */ 0.29431447,-0.37444034,0.35139787,-0.37529132, /* bias */ 0.24774797,0.09204272,-1.0231098,0.14390624, /* bias */ 0.0003230142,-0.17254636,-0.32850498,0.291209, /* bias */ 0.1735064,-0.4576754,-0.76062876,-0.43811232, /* bias */ -0.638915,-0.4367048,-0.253564,-0.0193794, /* bias */ -0.056036152,-0.2655969,-0.059854627,0.1378513, /* bias */ 0.24290895,0.62050456,-0.9127042,0.1934067, /* bias */ 0.0,0.41116375,-0.11640373,0.44771346, /* bias */ 2.4103256e-06,0.3375145,-0.48310238,0.38121364, /* bias */ 0.12730102,-0.29908195,0.52429354,-0.28219193, /* bias */ 1.0750377,-0.11793279,0.6446215,-0.44602153, /* bias */ 0.7545985,0.13627762,-0.45721877,0.21879677, /* bias */ 0.0,0.20851132,0.48091263,0.9139804, /* bias */ -0.92144644};
const float nv1[] = {-0.04304739,-0.040557653,0.06273674,-0.062496893,0.030465797,0.03307364,0.06333267,-0.047295507,-0.06078761,0.01841037,-0.087970056,0.034147475,-0.09294898,-0.57730436,-0.2817628,0.04295613, /* bias */ -0.008993808,-0.058301527,0.06213507,0.08108177,-0.020443933,-0.029178683,-0.12463052,-0.19275494,-0.36155888,-0.021774864,-0.021767603,0.08170835,-0.3155085,0.28161997,0.03290635,-0.043577507,-0.2719435, /* bias */ 0.24550056,0.049762726,-0.02716966,0.061025236,-0.040225115,0.0017402614,-0.10296145,0.023425946,-0.098629765,0.0071707135,0.016772764,-0.026235979,-0.012678294,-0.2866619,-0.005575278,-0.0024562972,0.08665302, /* bias */ 0.028602168};
float nx3, ny3, nz3;
void norm_neural(float x, float y, float z)
{
    float h[16] = {0};
    for(int i = 0; i < 16; i++)
    {
        const int j = i*4;
        h[i] = (nv0[j] * x) + (nv0[j+1] * y) + (nv0[j+2] * z) + nv0[j+3];
    }
    float o[3] = {0};
    for(int i = 0; i < 3; i++)
    {
        const int j = i*17;
        for(int k = 0; k < 17; k++)
            o[i] += (nv0[j+k] * x);
        o[i] += nv0[j+17];
    }

    nx3 = o[0];
    ny3 = o[1];
    nz3 = o[2];
}

// tanh_adam_0_256_128_33333333_6_[0.98]
const float n1v0[] = {-0.657967,-0.06945462,0.10270959, /* bias */ 0.44337878,-0.85571986,-0.042382855,0.07842382, /* bias */ 0.0001989177,-0.6795417,-1.319329,-0.1378362, /* bias */ 0.0064335065,1.1173787,0.05247878,0.22207925, /* bias */ 0.0449048,-0.13566425,1.4154208,0.0675685, /* bias */ -0.06828171,-0.71841806,0.3000583,-0.07873827, /* bias */ 0.0011885519,-0.4006133,-0.99689615,-0.10031121, /* bias */ -0.17227808,-0.7351725,-0.25630295,0.5517423, /* bias */ -0.42445207,-0.03687073,2.399952,0.073263586, /* bias */ -0.03199772,-0.16965024,-0.082687125,-0.09365248, /* bias */ -0.037501354,-0.061016735,0.05617761,-0.12030189, /* bias */ 0.0055396045,-0.091487646,-1.3136581,0.15078555, /* bias */ -0.116480894,0.40862992,0.061737202,1.4157567, /* bias */ -5.9131624e-05,-0.32692224,-1.7704996,-1.0707452, /* bias */ 0.54724854,-0.11359544,0.27022192,-0.0527967, /* bias */ 0.022396289,-1.0636157,-0.0821234,1.2375853, /* bias */ -0.350863,0.9113397,-0.43764845,-0.75785094, /* bias */ 0.107842125,-0.30988804,0.12607849,0.04892221, /* bias */ -0.00050595676,-0.030445397,0.07127634,-1.1995641, /* bias */ 0.508855,-0.017436985,0.99561965,1.8242065, /* bias */ -0.17740938,0.64014715,0.08863013,-0.1153708, /* bias */ -0.024321236,0.6056345,-0.6682658,-1.2900836, /* bias */ 0.2536608,0.102457024,0.050162293,-0.1357965, /* bias */ -0.5102635,-1.6951511,1.0346888,-0.09898559, /* bias */ 0.10880215,0.09047974,-0.1257974,-0.064336814, /* bias */ -0.08027326,0.080256656,0.12422634,0.038340602, /* bias */ 0.2869928,0.124076456,1.2153233,0.27492255, /* bias */ 0.0446819,0.99200356,0.18295166,1.9254644, /* bias */ -0.01058229,-0.058948766,-0.06366435,0.8125598, /* bias */ -0.0006121423,0.08861807,-1.2626783,0.5423945, /* bias */ -0.00040374033,0.1727365,0.43786666,-1.4505035, /* bias */ -0.07080843,-0.052003305,0.66611725,0.017678624, /* bias */ 0.07394746,-0.009760263,-0.030512225,0.033700015, /* bias */ -0.01744024,-0.54245824,0.9469725,-0.17972603, /* bias */ -0.025385525,0.5758153,-0.08437279,-0.032749824, /* bias */ 0.0054064603,0.37314397,-2.63386,-0.04030058, /* bias */ 0.0054415055,-0.9892183,0.8117658,-0.7038477, /* bias */ 0.11644376,0.16293474,-0.16333398,-1.4034195, /* bias */ 0.010277443,0.88500845,0.077693366,-0.06603294, /* bias */ -0.43498698,0.59875524,0.04008979,0.65409327, /* bias */ 0.25880042,-0.07167615,-0.05301648,-0.07438834, /* bias */ -0.026129039,-1.2295057,1.562398,-0.055985194, /* bias */ -0.04876403,-0.5705364,-0.16064796,-0.0877732, /* bias */ -0.0045049055,-0.07641899,-0.6008323,-1.6531501, /* bias */ -0.5059362,0.06617785,1.6329868,0.51083964, /* bias */ 0.037763383,-0.022616236,0.6563467,0.9168906, /* bias */ -0.26113477,0.13186333,0.1982625,0.036235426, /* bias */ -0.001359776,-0.027560329,0.6212371,0.096906595, /* bias */ 0.07828481,0.04706239,-0.57657063,0.6818023, /* bias */ 0.55165803,-0.1862059,0.067069575,0.13873313, /* bias */ 0.8593017,0.120084375,0.98995525,-0.07348934, /* bias */ 0.27516153,0.023586249,-0.15814999,0.04632986, /* bias */ 0.41339827,0.047976065,-0.89208025,0.042319518, /* bias */ 0.020634374,-0.6099116,1.0089276,-0.024174307, /* bias */ 0.040273897,0.15698133,0.06858294,-0.91034263, /* bias */ -0.058024965,-0.6070976,-0.052479267,0.67269355, /* bias */ 0.0093086045,-0.9204495,1.0411464,0.07186446, /* bias */ -0.35739774,-1.9914569,-0.029029068,-0.33552274, /* bias */ 0.024075633,-0.17558068,0.65578085,-0.104819834, /* bias */ 0.27797908,-0.02353006,0.14203712,1.401212, /* bias */ 0.19407822,-0.036621954,-1.497707,1.4231261, /* bias */ -0.8619967,0.23912287,0.6573722,-1.6238776, /* bias */ 0.014871087,0.017074998,0.05618719,-1.704618, /* bias */ -0.02563146,-0.2556464,-1.28369,-0.5379334, /* bias */ 0.17202416,0.050197393,-0.14634134,0.28392977, /* bias */ 0.36572304,-0.75307435,-0.041303728,-1.0581723, /* bias */ 0.049363717,0.2656227,0.23411454,-0.13829225, /* bias */ -7.122074e-05,0.015168814,0.12478221,-0.16382758, /* bias */ 0.0618041,1.3529884,0.3803986,0.66143674, /* bias */ 8.222485e-06,-0.07532298,0.13686718,-0.47696775, /* bias */ -0.18033381,-0.073953554,0.16968049,-1.6956091, /* bias */ -0.0691714,0.2219424,0.017249772,0.06473102, /* bias */ -0.0020143017,-0.10947408,-0.09585423,0.5118237, /* bias */ 0.026603347,0.018082522,2.9610877,-0.21749048, /* bias */ -0.047192194,-0.8082115,0.48628795,0.1809453, /* bias */ -0.07856498,1.086738,-1.7620313,-0.90346, /* bias */ 0.07801507,-0.9255175,0.13365355,0.10670721, /* bias */ 0.05701986,0.09092345,0.12039124,0.027614415, /* bias */ 0.055775043,0.0892342,-1.3741384,0.18869716, /* bias */ 0.00021411858,0.07119533,2.9546595,0.08121421, /* bias */ 0.30046812,0.7549166,-0.9778302,2.197252, /* bias */ 0.3450571,2.7265337,-0.17289463,-0.076880045, /* bias */ 0.028687617,0.023590745,-0.7281941,0.73276615, /* bias */ 0.051381625,0.1930387,-0.08679789,-0.03783819, /* bias */ -0.33549842,0.03822142,-0.08241056,0.05492674, /* bias */ -0.013904958,-1.0360603,2.0399258,-0.11384988, /* bias */ -0.0017613035,0.15866382,-0.6377475,-0.18009517, /* bias */ -0.18586935,0.054781724,1.1914073,0.7364881, /* bias */ 0.37261975,-0.07107273,0.89671,0.11724416, /* bias */ 0.32568514,-2.3746054,-0.06947282,-0.42244005, /* bias */ 0.47786102,0.15693794,0.81875575,0.2613177, /* bias */ 0.034178466,-0.08084042,1.9122362,0.7545419, /* bias */ 0.035756014,-0.117612675,1.2132046,3.4891515, /* bias */ -0.26799363,0.009936016,-0.02028196,-0.3673609, /* bias */ -0.08148172,0.11460884,-0.026187321,-0.087948956, /* bias */ 0.2731191,-0.035622217,-0.103899956,0.056298535, /* bias */ 0.26173046,-0.10587079,-0.028573021,-0.9692012, /* bias */ -0.0276674,0.07143046,-0.50054383,0.094629884, /* bias */ -0.041347913,-0.570161,-0.10530218,0.28221202, /* bias */ 0.0034205797,0.8630893,-0.15675494,-2.408234, /* bias */ -0.19273102,-0.018258676,-0.81955403,-0.04690453, /* bias */ 0.2747438,-0.7647208,-0.9423373,1.9445401, /* bias */ -0.07610269,-0.5616927,1.9635824,0.013440965, /* bias */ 0.49781832,0.21172918,-0.13888338,0.11221347, /* bias */ -0.042212836,0.6529775,-0.7853812,-0.95684737, /* bias */ -0.0728477,-0.4422746,0.38984638,0.09940322, /* bias */ -0.83366853,-0.11163928,-1.2094852,-0.48189896, /* bias */ 0.6288223,0.6164533,0.11234345,0.16982135, /* bias */ -0.12767406,-0.027090713,0.7159245,-0.9675206, /* bias */ -0.17780402,-0.03148789,0.13759597,-0.02012942, /* bias */ 0.24481906,-0.15062086,0.11868926,0.092077635, /* bias */ 0.17795545,0.5093109,0.023413012,-0.73203516, /* bias */ 0.010032756,0.084462784,0.7964468,0.08455492, /* bias */ -0.022414109,0.58285517,-0.15644649,-0.06291129, /* bias */ -0.3026084,-1.0488058,-3.7743487,0.83127964, /* bias */ -0.0132175395,-1.420057,0.13167262,-1.5825763, /* bias */ 0.034693938,-0.78648573,-0.17416023,-1.1537151, /* bias */ -0.0066916225,1.0660343,-0.13621022,-0.54400396, /* bias */ -0.26852182,0.08813795,-0.37495893,0.7317461, /* bias */ 0.04131709,-0.24249814,0.28517145,-0.09248124, /* bias */ 0.23052971,-1.0557607,0.14492534,0.24070059, /* bias */ -0.056501694,-0.89069504,-0.80243737,0.6219175, /* bias */ -0.009527428,-0.43252242,0.057761174,-0.016233345, /* bias */ -0.0066771815,-1.021425,-0.845559,0.10267649, /* bias */ -0.58469826,-0.06603688,0.4224668,0.76396894, /* bias */ 0.672747,-1.1640007,-0.045749985,-1.2618877, /* bias */ -0.0006680466,-0.16003254,-0.9580769,-0.42989716, /* bias */ 0.11071192,-0.069904506,0.7173603,-0.026324105, /* bias */ -0.064112075,-0.043031976,-0.042047672,-0.08090442, /* bias */ -0.0028388181,-1.0954927,0.123795636,-0.3868709, /* bias */ -0.0044781948,-2.0674474,-0.20614323,-1.3469784, /* bias */ -0.019262886,-0.962882,0.019011158,0.018801922, /* bias */ 0.096748546,0.11635528,-0.6519606,-1.1968417, /* bias */ 0.011726297,0.061599486,0.16535522,1.3319991, /* bias */ 0.19475275,-1.0447865,-0.028364254,0.1048019, /* bias */ -0.73046845,0.14336564,0.18981262,-0.82250845, /* bias */ -0.057768285,-0.05726984,0.19278207,-0.038779825, /* bias */ -0.36538625,0.015355976,0.17581736,1.2638432, /* bias */ -0.53629,0.2341536,1.8221171,-0.89040786, /* bias */ 0.03466087,-0.13111041,0.12478919,0.14315358, /* bias */ 0.015688282,-0.039803516,1.0984997,-0.015376302, /* bias */ 0.031697843,0.26436293,1.0691743,0.8409561, /* bias */ -0.032837674,-3.933529,0.61869776,-2.212914, /* bias */ -0.33254424,0.6518732,-0.029949808,0.4345103, /* bias */ 0.0002084176,-0.05367327,-0.111811794,0.061123233, /* bias */ 0.04775034,-0.6902556,-0.07115571,0.54365283, /* bias */ -0.20709491,-0.5077683,0.14787161,-1.41042, /* bias */ 0.013363677,0.775008,0.23423074,0.077652775, /* bias */ -0.033820786,0.3546334,1.8363763,0.6889763, /* bias */ 0.029423477,-0.30984238,0.08616469,-0.11534633, /* bias */ -0.00024982853,0.21130325,1.1515262,-0.20392029, /* bias */ 0.030119635,0.917576,-1.5464693,0.008603078, /* bias */ 0.4148677,-0.10063848,0.30174994,0.11129181, /* bias */ -0.021174436,-0.021133253,-0.56614363,-3.0056949, /* bias */ 0.07609065,-1.5643492,-0.15593733,0.08065939, /* bias */ -0.0010826606,1.5635995,-0.09311255,-3.7892988, /* bias */ 0.06575874,0.2766254,0.09533542,0.035989836, /* bias */ 0.08008292,0.19496894,-0.09821075,-0.14112128, /* bias */ -0.24300843,0.29149815,0.12066247,-0.11299458, /* bias */ 0.1428224,-0.17940074,0.9580589,-1.7597989, /* bias */ 0.3927889,-0.42502597,-0.7556674,0.7294374, /* bias */ 0.05944037,1.197769,-0.68328,0.07738191, /* bias */ 0.006271543,0.12896094,0.14331542,0.025475655, /* bias */ 0.043112118,0.9356022,0.06159858,1.0085746, /* bias */ 0.043874204,0.21890227,0.058292124,-0.04882227, /* bias */ -0.0028979785,0.03027313,0.5861714,0.8606727, /* bias */ -0.17749004,-0.27226704,-0.14504127,-0.09058645, /* bias */ -0.026525937,-0.1318394,0.017122708,-0.5120272, /* bias */ 0.014986306,0.5398743,0.14224717,-0.12349439, /* bias */ 0.24599916,-0.018962514,0.030608429,-0.16646555, /* bias */ 0.29596305,0.059825763,-0.7931817,-0.68263584, /* bias */ 0.18918565,-0.12882695,0.076106586,1.1296517, /* bias */ 0.4602624,-0.09090048,0.14944534,-0.7340161, /* bias */ -0.31012225,0.78822494,-0.06188547,-0.864325, /* bias */ -0.169327,0.17433289,0.25548032,-0.10835768, /* bias */ -0.045294825,1.2914077,0.090307415,1.0467234, /* bias */ -0.55005103,0.033086054,-0.12541668,-0.43643427, /* bias */ -0.0746223,-1.0162754,-0.04366131,-0.7987345, /* bias */ -0.027580362,-0.34040496,0.7103906,-0.26528385, /* bias */ 0.027482368,-0.42869177,0.084129594,-0.0733412, /* bias */ -0.35396555,-0.1147181,-0.08044875,-0.0891156, /* bias */ -0.05178229,0.15988685,-0.041694608,-0.084099144, /* bias */ -0.06829126,0.81387454,0.08507992,-1.5167897, /* bias */ 0.18080181,0.15996204,-0.6148977,2.105891, /* bias */ 0.056242622,0.36275518,0.9327391,-0.073388815, /* bias */ -0.080904655,0.3216148,-1.1964486,1.7846254, /* bias */ 0.14572991,-0.12524739,1.3030993,0.955588, /* bias */ 0.048355266,-0.48929542,1.3046714,-0.34821162, /* bias */ 0.08318714,0.10597658,0.054013573,-0.15938553, /* bias */ -0.84329337,0.16283743,-1.220589,-0.11880875, /* bias */ 0.531046,1.0323254,-0.50343645,-1.8749641, /* bias */ -0.21203913,0.09716379,-0.07812718,0.6538246, /* bias */ 0.22934823,1.4315898,-1.2795424,0.12135291, /* bias */ 0.006584957,0.17231357,-0.11119128,0.79776835, /* bias */ 1.1134186e-05,-1.0523362,-0.12273118,0.06859429, /* bias */ 0.03240925,-0.13829781,-0.1442063,0.11074956, /* bias */ 0.009515561,0.08200171,0.04580723,0.14374426, /* bias */ -0.057321414,-0.79145753,-2.7845485,-1.0301464, /* bias */ -0.22868992,0.047082044,-0.28110358,-0.08999545, /* bias */ -0.08280287,-0.122323625,0.8956975,0.13480547, /* bias */ 0.009864441,0.91162825,0.5770123,0.036419235, /* bias */ -0.0329742,0.5152193,0.5990616,-0.14916827, /* bias */ 0.08145683,0.70438296,0.038043987,-0.77656406, /* bias */ -0.00020447286,-0.049798604,0.23724592,1.472585, /* bias */ -0.07738372,-1.0361906,-0.023381494,-2.5254118, /* bias */ 0.1791676,-0.0655824,-0.03658666,-2.1861205, /* bias */ -0.055895653,0.35555646,-0.034525316,1.1875923, /* bias */ -0.18636838,-1.2116364,2.223804,0.08032254, /* bias */ -0.05257641,-0.1150894,0.6855461,-0.98052776, /* bias */ 0.037358265,0.072437204,-0.17479517,-1.715434, /* bias */ 0.22987679,0.037478555,0.6891184,-0.14537334, /* bias */ -0.024655806,-0.024591858,-0.114938974,0.85021037, /* bias */ 0.17259425,-0.4652865,-0.13136892,0.88041854, /* bias */ -0.057048693,-0.1862556,-0.085639745,-0.15538889, /* bias */ 0.5854778,-0.01775067,0.5920098,0.16253167, /* bias */ 0.04510915,1.4591604,0.57210857,-0.22816575, /* bias */ 0.06600651,0.7248421,-1.1222186,0.1573904, /* bias */ 7.9276855e-05,0.25544256,0.21316794,-0.053196087, /* bias */ -0.06820544,0.6785889,0.100006476,0.12613899, /* bias */ -0.45527282,-0.63780093,-1.3959488,-0.112578645, /* bias */ 0.115423895,0.087477885,0.06309555,0.061366327, /* bias */ -0.2709076,1.0320114,-0.12562542,0.18431896, /* bias */ -0.08353798,-0.07512347,0.45545587,0.181541, /* bias */ -0.23180327,-0.9704861,0.045618847,-0.6801697, /* bias */ -0.2645901,-0.9799992,-0.13951811,0.054406084, /* bias */ -0.050463993,0.1555998,-0.025353882,1.5021083, /* bias */ 0.38208705,-0.23984061,0.02108647,-0.9868603, /* bias */ -0.47692722,-0.88959783,0.11930951,0.71122396, /* bias */ 0.5083806,-0.03480656,1.7529327,-0.14725679, /* bias */ 0.05849089,-1.6656352,-0.06051707,-0.16717394, /* bias */ 0.00048618938,0.07208946,-0.77503204,-0.14044389, /* bias */ 0.037833266,0.5971736,1.3417729,0.037057582, /* bias */ 0.048964005,0.7362865,0.8186912,0.2011997, /* bias */ -0.00037810983,0.15963139,0.40149167,-0.31404614, /* bias */ 0.0058242357,0.77257264,2.0711026,0.17694761, /* bias */ 0.043801807,-0.08626153,0.024228469,-0.79775614, /* bias */ -0.03173909,-0.11487855,-1.1034452,0.3237038, /* bias */ 0.09702727,0.21105897,-0.07325218,0.57079643, /* bias */ 0.013226531,0.07431789,-0.18702094,1.4022933, /* bias */ -0.12477694,0.44259244,0.7108811,-0.099486716, /* bias */ 0.036076944,0.080153786,-0.56432676,-0.14417008, /* bias */ 0.19202629,0.26211002,-1.0834059,-3.6179109, /* bias */ -0.08955645,0.43926594,0.03593192,-0.11842106, /* bias */ 0.674514,-0.07938213,-1.793119,0.9243092, /* bias */ -0.56706154,-0.22532326,-0.022258542,-0.85931164, /* bias */ -0.03902177,0.5373441,-1.7885513,1.1432853, /* bias */ -0.045514826,0.77635634,1.5900334,1.4234822, /* bias */ 0.007110582,0.09409583,0.056927096,0.07088078, /* bias */ -0.02093537,0.09004617,0.059925858,0.117056996, /* bias */ 0.39869308,1.1368843,0.019896233,0.13491023, /* bias */ 0.108873956,-0.10673143,0.17557696,-1.4126544, /* bias */ -0.01208452,1.0293833,-0.35483673,-0.26072097, /* bias */ 0.0016237056,-0.05184242,-0.08403838,0.41397262, /* bias */ 0.033083353,1.4511083,-1.737539,0.045914985, /* bias */ -0.03133368,-0.0759613,-0.31727824,0.18648434, /* bias */ 0.032586165,-0.09436493,0.15447415,0.95872784, /* bias */ -0.18482189};
const float n1v1[] = {-0.0018870501,0.0070576705,-0.0022904177,0.12850343,-0.019402888,-0.12002552,-0.0041477396,0.008251963,-0.12621115,-0.009475504,-0.0062396894,0.014098277,0.12962659,-0.036871724,-0.08149692,-0.0003027694,0.04620284,0.11255271,-0.0027198659,0.004547716,-0.0020033072,-0.006593321,0.0024434011,0.0036045727,-0.07616822,-0.028761055,0.10289524,0.0072285337,0.004947236,-0.006077141,-0.0428979,0.1404801,-0.06324115,0.0011113742,-0.009337606,0.0005008352,0.0024007026,0.074096665,-0.06746081,0.0061730626,-0.0034076793,0.006267985,0.10049661,-0.024628729,0.08430695,-0.0054277577,0.00468751,0.00671289,0.0074947528,0.0046656015,0.0034342485,-0.059456963,0.095251694,-0.034145262,-0.0015014245,0.011031564,-0.0024471132,-0.0070990603,0.0069249687,-0.0076171756,-0.0991812,0.15423805,-0.015509574,-0.0050033065,0.007816099,-0.004507784,-0.00034828458,0.011180796,-0.0008443266,0.008594677,-0.0031867053,0.012906365,-0.0023218745,0.0011099793,-0.013302006,0.009011429,-0.00042866607,-0.0017670623,-0.092255615,0.08477959,0.05072063,0.099635296,0.017383311,0.0029533983,-0.070996545,0.047245145,-0.03129024,-0.06612522,0.054678693,-0.05353224,-0.028877523,-0.034676492,-0.062898256,0.12582846,0.03248801,0.12755193,0.09463804,0.06153042,-0.03199223,0.043406848,0.10369234,0.0070235725,-0.009728804,-0.0064030085,0.0064401706,-0.11130146,0.13837257,-0.05021068,0.003003148,-0.002730893,-0.008986877,-0.13131164,-0.09535855,-0.15097885,0.0070206285,-0.0022142308,-0.0028473067,-0.0006603714,0.00043782205,0.010295628,-0.009799194,0.000671426,0.0017127122,-0.008485908,0.0051214946,0.0072348756,-0.009334324,-0.13567725,-0.046609942,0.0009025545,-0.009375175,0.00078710174,-0.0017763943,0.00036712846,-0.0051746066,-0.0035316478,-0.0024089946,0.0061127585,0.058315057,-0.05304622,0.051801402,0.009294829,-0.007432982,0.010011882,0.007344985,-0.009486673,0.0087378705,-0.00208124,0.010095244,-0.0023782235,-0.003884851,-0.0023279581,0.0063938918,-0.0004396601,0.009095767,-0.0016950829,-0.11045102,-0.13168767,0.01241062,0.0021272835,0.006382475,-0.00024675595,0.0015514401,-0.011248533,-0.008211881,0.047398385,-0.12486933,-0.1494066,-0.0074480893,0.005523573,-0.0076342234,0.0008929593,-0.004464694,-0.0019261064,0.008340376,-0.009856341,0.009200687,0.011880606,-0.001691931,-0.0028723795,0.002184918,0.00059862377,-0.0065920297,-0.1281697,-0.025744308,-0.057475787,-0.12318433,-0.1186962,-0.056469914,0.0016405117,-0.0035575884,0.0017323489,-0.004000028,-0.0020472587,0.009397914,-0.0066422527,0.004603183,-0.006838291,0.10659828,0.12845579,0.11860969,0.0005832361,0.00094334054,-0.093702845,0.07034703,-0.034395352,-0.100435086,-0.0074648694,0.002711829,0.0032554243,0.0030013283,-0.0018512995,-0.0030926531,0.11876915,-0.09964569,-0.13025095,0.0017879416,0.07783133,0.09492693,-0.06973445,-0.07162373,-0.027076857,-0.083543174,0.07552059,-0.041490417,0.0977953,0.15389606,-0.037103307,-0.078696735,0.0019740297,-0.12635486,0.00034330192,0.008586304,0.0013837584,0.05144949,-0.019368261,-0.13623892,0.010301568,-0.005197488,-0.006175473,0.00018101936,-0.00057580427,-0.00981741,0.0065391036,0.004457927,-0.0071442267,-0.0041009984,-0.10600822,-0.057815734,0.019402383,0.0032656353,-0.0031924404,0.14097832,-0.06381808,-0.01922193,0.11002988, /* bias */ -0.0044576735,-0.006314603,0.052419763,0.007742451,-0.0117595885,0.009110222,0.0002460705,-0.008783358,-0.0002229919,-0.013421393,0.007265239,0.008975854,0.0050152536,-0.015549152,0.0064262534,-0.0025286477,0.00088377367,-0.016847407,0.0025369686,-0.0072846357,0.0022306812,-0.0073093963,-0.0033170113,0.0030605209,0.040093746,0.019789249,0.09841017,0.002009077,-0.0043435623,0.0026357677,0.0003853824,0.006280962,0.00023860252,-4.770334e-05,-0.00018211096,-0.015243039,-0.0008660619,-0.009554289,-0.0009813742,0.000101942256,0.0035947573,0.014328206,-0.0024682644,-0.0012349194,0.00701818,0.006805427,0.0044996617,-0.007929681,-0.007118868,-0.006244643,-7.223923e-05,0.002642389,0.0005130836,-0.015575187,0.04261299,0.09773873,0.030116608,-0.0007487752,-0.010379581,-0.001247651,0.0017062556,-0.00045192984,-0.011912971,-0.012346281,-0.0006385207,0.0016252218,-0.00052366336,-0.011493208,-0.0008971797,-0.007605237,-0.0049231015,0.009734931,0.0062767663,0.0036408454,-0.010052788,-0.002523221,-0.001079651,0.009732754,-0.015562948,0.12137084,-0.11747167,0.0649384,0.056973338,0.09238159,-0.010226162,-0.006896631,0.005645965,0.0076341503,-0.0057174326,-0.008086755,-0.14565428,-0.15261728,-0.036766354,0.028472722,0.1255356,0.120519914,0.0019519897,0.00057951914,-0.006469122,0.00017284378,0.007773074,0.0010253526,0.003098919,-0.0061104284,0.0036157134,-0.03126158,-0.08147417,-0.118100606,0.0004047305,-0.011586487,-0.00071307796,-0.07779392,0.11353339,-0.10069855,-0.0065765986,-0.0044394466,0.004793066,0.012792631,-0.002572599,-0.0035716793,0.09297984,0.09998426,-0.08712395,-0.0059078136,0.0049838955,0.008290096,-0.045273986,-0.007753098,-0.12099274,0.019763649,-0.045657754,-0.12303256,0.011785366,0.09763558,0.14593573,-0.010069225,-0.0007666348,-0.0009281265,-0.013413417,-0.0070462325,0.0051304777,0.111999296,0.035626635,0.12655745,0.006356827,-0.0038958672,0.0073533426,0.0024704735,-0.011506912,0.0026596447,0.0020408635,-0.006848017,-0.01129061,0.0020383117,-0.0049555465,0.0023375966,0.007335061,-0.0053582275,-0.008241713,0.008279419,-0.0017205721,0.0092479605,0.0072009997,-0.0006020166,0.009939332,-0.0009999764,0.00748165,0.012809316,-0.00055971986,-0.009153295,-0.0009838025,0.0027605896,-0.006836948,0.0043448773,0.084903054,0.08904208,0.12994148,0.073223345,0.12967867,0.11573712,-0.0035713385,0.008429548,-0.0038433727,0.0056001125,-0.0054132426,-0.0096072955,-0.0575482,-0.038027607,-0.07392705,0.12062464,0.058320105,0.14479746,0.0727875,0.08366352,0.008829303,0.13544218,-0.0077439533,-0.13157077,0.005756713,-0.005595952,0.0061460324,0.08685457,-0.04288888,0.077679254,-0.09423139,0.0872121,0.05367897,-0.047999594,-0.123272926,-0.0035659105,5.015314e-05,-0.0010044005,0.011072919,0.032591123,-0.071983084,0.014765546,-0.0073790634,0.012251672,-0.009136088,0.00082758954,0.00491331,0.0027207474,-0.0028508455,0.012007041,-0.004496564,0.006041255,-0.0044195796,-0.0050791483,0.12881733,0.007738358,-0.07419602,0.10908688,-0.1262759,-0.14079039,0.0754072,-0.02284915,-0.15118112,-0.009227341,-0.00058339606,-0.0015144767,-0.0061219768,0.005310663,0.011528921,-0.0021478382,0.00017285557,-0.008592507,0.008424275,0.0005693111,0.000660199,-0.0049743284,0.006849423,-0.006022062,0.009444429,0.006362566,-0.008676191,-0.00017451038,-0.00829328, /* bias */ -0.009038631,8.224485e-05,-0.016694022,0.0034375915,0.0057113934,0.00019816586,-0.009016376,-0.00036961667,-0.0049235066,0.003596334,0.016976045,-0.012014218,0.0018712217,-0.016401289,0.0031570871,0.0009528913,-0.007987099,-0.014926858,0.14667091,-0.07746088,0.13011049,-0.014806509,-0.080293275,-0.08524207,0.007246223,-0.018997377,0.009271853,-0.0029528758,-0.005474085,0.000285431,-0.0012580142,-0.008458225,-0.012284676,0.0034342564,0.0042044213,0.0055817133,-0.003265752,0.0064592203,0.11984066,0.10761286,-0.0061350237,0.0036599846,-0.008769402,0.004074989,-0.009934908,0.0040159733,0.0049660415,-0.049831774,-0.039562337,0.045809682,0.057111803,0.022400964,0.057203975,-0.014748014,0.0017235595,0.0033597758,-0.0013271868,0.008283194,-0.0008748331,-0.0058497633,0.0022155752,0.0029050263,-0.0025298828,-7.910651e-05,0.0110407965,-0.115965955,0.07584755,-0.12710766,-0.043332446,0.021451145,0.03503726,0.012888746,0.00649049,0.0007743696,-0.0060205553,0.010931049,-0.0073050084,-0.0010803932,-0.012261819,-0.004348488,-0.0053357417,0.006018827,-0.0055301227,0.0021001485,-0.0116097,0.0023276869,0.010225462,-0.0030244447,0.013633449,-0.113377415,-0.10015166,0.1393577,-0.0013756718,0.004044657,0.010051016,0.12934925,-0.045398153,-0.0010602803,-0.008697208,0.004023353,-0.015240261,0.0077265264,-0.005182687,0.008017575,0.00012289043,-0.008329119,0.0013477778,0.004196274,-0.010415069,0.004208864,-0.08778519,-0.022069097,0.029115377,-0.08012874,0.12902996,0.015432661,-0.0022145873,0.004877845,-0.0013018455,-0.13371967,-0.12237334,0.05165225,0.0002547873,-0.014465061,0.00050617586,-0.008247062,0.004186907,-0.006414578,-0.0007765291,-0.0013314383,-0.009683,0.0012057674,0.0005972652,0.016473634,-0.012550967,0.0010616058,0.021065565,-0.014167694,-0.016584069,-0.13238682,-0.08796964,0.04507228,0.11811031,0.0029551985,0.00095375965,-0.009194829,0.00023175642,0.0020673887,0.015935233,0.008946582,0.000630378,-0.00023200782,-0.011878544,-0.0061983936,7.0434224e-05,-0.0048953593,0.0063630603,-0.004965207,0.0019902114,-0.010095469,0.0024342188,0.0040870644,-0.0011577545,-0.02129592,0.008140377,-0.007280727,0.009050399,-0.004337295,0.0014137547,0.0015620524,-0.0055371076,0.0051551843,0.0077854865,-0.0039445967,-0.0025590265,0.0061104964,0.1253059,-0.117743835,-0.13265087,0.05251685,0.04083345,0.040831294,-0.022685185,-0.0036806765,-0.032409545,0.14438425,-0.01943336,0.0054625426,0.0008107505,0.0062082973,0.0010891336,-0.08541905,0.08737308,-0.09268933,-0.0108269155,0.0060982155,0.007977286,0.0515907,0.016578794,0.05915409,0.09337122,-0.1387457,0.122887425,0.009727938,0.0011779472,-0.00030057097,-0.09773577,-0.062906176,-0.11490103,0.00467094,0.0020788792,-0.008669346,-0.0035466503,0.0030833958,0.003228706,0.010886042,-7.204527e-05,-0.0018297082,0.010770383,0.000518158,-0.0014662759,-0.08881102,0.1327827,-0.14893018,0.12096398,0.05882498,0.054345753,0.0010439275,-0.00079413445,0.011493921,-0.0049767075,-0.0032523065,0.011872142,0.0031566452,0.0019139193,-0.0093503725,0.1042644,0.09903431,0.045683604,0.027117595,-0.015584289,0.045032714,-0.0021299592,5.166531e-05,-0.012961451,0.0018137299,-0.0006207982,0.009955503,0.13454516,0.1147649,0.12976451,-0.12543525,0.056863315,-0.0874813,-0.008163677,-0.0055276453,0.008479686, /* bias */ -0.002458373};
float nx4, ny4, nz4;
void norm_neural_256(float x, float y, float z)
{
    float h[256] = {0};
    for(int i = 0; i < 256; i++)
    {
        const int j = i*4;
        h[i] = (n1v0[j] * x) + (n1v0[j+1] * y) + (n1v0[j+2] * z) + n1v0[j+3];
    }
    float o[3] = {0};
    for(int i = 0; i < 3; i++)
    {
        const int j = i*257;
        for(int k = 0; k < 257; k++)
            o[i] += (n1v0[j+k] * x);
        o[i] += n1v0[j+257];
    }

    nx4 = o[0];
    ny4 = o[1];
    nz4 = o[2];
}

float dist(float x1, float y1, float z1, float x2, float y2, float z2)
{
    const float xm = (x1 - x2);
    const float ym = (y1 - y2);
    const float zm = (z1 - z2);
    return sqrtf(xm*xm + ym*ym + zm*zm);
}

int srandfq = 6543;
float randf()
{
    // https://www.musicdsp.org/en/latest/Other/273-fast-float-random-numbers.html
    // moc.liamg@seir.kinimod
    srandfq *= 16807;
    return (float)(srandfq & 0x7FFFFFFF) * 4.6566129e-010f;
}

int main()
{
    float antioptim = 0.f;
    uint64_t stm, st, stf, stmf;

    ///

    printf("Speed Test\n");

    ///

    stm = microtime();
    st  = __rdtsc();

    for(uint i = 0; i < NUM_ITERATIONS; i++)
    {
        norm_neural_256(randf()*10000000, randf()*10000000, randf()*10000000);
        antioptim += nx4+ny4+nz4;
    }

    stf  = __rdtsc()-st;
    stmf = microtime()-stm;

    printf(":: norm_neural_256() :: %'lu μs, %'lu Cycles\n", stmf, stf);

    ///

    stm = microtime();
    st  = __rdtsc();

    for(uint i = 0; i < NUM_ITERATIONS; i++)
    {
        norm_neural(randf()*10000000, randf()*10000000, randf()*10000000);
        antioptim += nx3+ny3+nz3;
    }

    stf  = __rdtsc()-st;
    stmf = microtime()-stm;

    printf(":: norm_neural_16()  :: %'lu μs, %'lu Cycles\n", stmf, stf);

    ///

    stm = microtime();
    st  = __rdtsc();

    for(uint i = 0; i < NUM_ITERATIONS; i++)
    {
        norm(randf()*10000000, randf()*10000000, randf()*10000000);
        antioptim += nx+ny+nz;
    }

    stf  = __rdtsc()-st;
    stmf = microtime()-stm;

    printf(":: norm()            :: %'lu μs, %'lu Cycles\n", stmf, stf);

    ///

    stm = microtime();
    st  = __rdtsc();

    for(uint i = 0; i < NUM_ITERATIONS; i++)
    {
        norm_inv(randf()*10000000, randf()*10000000, randf()*10000000);
        antioptim += nx1+ny1+nz1;
    }

    stf  = __rdtsc()-st;
    stmf = microtime()-stm;

    printf(":: norm_inv()        :: %'lu μs, %'lu Cycles\n", stmf, stf);

    ///

    stm = microtime();
    st  = __rdtsc();

    for(uint i = 0; i < NUM_ITERATIONS; i++)
    {
        norm_intrin(randf()*10000000, randf()*10000000, randf()*10000000);
        antioptim += nx2+ny2+nz2;
    }

    stf  = __rdtsc()-st;
    stmf = microtime()-stm;

    printf(":: norm_intrin()     :: %'lu μs, %'lu Cycles\n", stmf, stf);

    ///

    printf("\nAccuracy Test\n");

    ///

    float accuracy_inv = 0.f;
    float accuracy_intrin = 0.f;
    float accuracy_neural = 0.f;
    float accuracy_neural_256 = 0.f;
    for(uint i = 0; i < NUM_ITERATIONS; i++)
    {
        norm(randf()*10000000, randf()*10000000, randf()*10000000);
        norm_inv(randf()*10000000, randf()*10000000, randf()*10000000);
        norm_intrin(randf()*10000000, randf()*10000000, randf()*10000000);
        norm_neural(randf()*10000000, randf()*10000000, randf()*10000000);
        norm_neural_256(randf()*10000000, randf()*10000000, randf()*10000000);

        // we will assume norm() is the most accurate
        accuracy_inv += dist(nx, ny, nz, nx1, ny1, nz1);
        accuracy_intrin += dist(nx, ny, nz, nx2, ny2, nz2);
        accuracy_neural += dist(nx, ny, nz, nx3, ny3, nz3);
        accuracy_neural_256 += dist(nx, ny, nz, nx4, ny4, nz4);
    }
    accuracy_inv /= NUM_ITERATIONS;
    accuracy_intrin /= NUM_ITERATIONS;
    accuracy_neural /= NUM_ITERATIONS;
    accuracy_neural_256 /= NUM_ITERATIONS;

    printf("InvSqrt:   %f\nIntrinsic: %f\nNeural16:  %f\nNeural256: %f\n", accuracy_inv, accuracy_intrin, accuracy_neural, accuracy_neural_256);

    ///

    printf("\n%f\n", antioptim);
    return 0;
}
